<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>642_Design_Search_Autocomplete_System</title>
  <link rel="stylesheet" href="https://stackedit.io/style.css" />
</head>

<body class="stackedit">
  <div class="stackedit__html"><p><strong>642.  Design Search Autocomplete System</strong></p>
<p>Hard</p>
<p>Design a search autocomplete system for a search engine. Users may input a sentence (at least one word and end with a special character  <code>'#'</code>). For  <strong>each character</strong>  they type  <strong>except ‘#’</strong>, you need to return the  <strong>top 3</strong>  historical hot sentences that have prefix the same as the part of sentence already typed. Here are the specific rules:</p>
<ol>
<li>The hot degree for a sentence is defined as the number of times a user typed the exactly same sentence before.</li>
<li>The returned top 3 hot sentences should be sorted by hot degree (The first is the hottest one). If several sentences have the same degree of hot, you need to use ASCII-code order (smaller one appears first).</li>
<li>If less than 3 hot sentences exist, then just return as many as you can.</li>
<li>When the input is a special character, it means the sentence ends, and in this case, you need to return an empty list.</li>
</ol>
<p>Your job is to implement the following functions:</p>
<p>The constructor function:</p>
<p><code>AutocompleteSystem(String[] sentences, int[] times):</code>  This is the constructor. The input is  <strong>historical data</strong>.  <code>Sentences</code>  is a string array consists of previously typed sentences.  <code>Times</code>  is the corresponding times a sentence has been typed. Your system should record these historical data.</p>
<p>Now, the user wants to input a new sentence. The following function will provide the next character the user types:</p>
<p><code>List&lt;String&gt; input(char c):</code>  The input  <code>c</code>  is the next character typed by the user. The character will only be lower-case letters (<code>'a'</code>  to  <code>'z'</code>), blank space (<code>' '</code>) or a special character (<code>'#'</code>). Also, the previously typed sentence should be recorded in your system. The output will be the  <strong>top 3</strong>  historical hot sentences that have prefix the same as the part of sentence already typed.</p>
<p><strong>Example:</strong><br>
<strong>Operation:</strong>  AutocompleteSystem([“i love you”, “island”,“ironman”, “i love leetcode”], [5,3,2,2])<br>
The system have already tracked down the following sentences and their corresponding times:<br>
<code>"i love you"</code>  :  <code>5</code>  times<br>
<code>"island"</code>  :  <code>3</code>  times<br>
<code>"ironman"</code>  :  <code>2</code>  times<br>
<code>"i love leetcode"</code>  :  <code>2</code>  times<br>
Now, the user begins another search:</p>
<p><strong>Operation:</strong>  input(‘i’)<br>
<strong>Output:</strong>  [“i love you”, “island”,“i love leetcode”]<br>
<strong>Explanation:</strong><br>
There are four sentences that have prefix  <code>"i"</code>. Among them, “ironman” and “i love leetcode” have same hot degree. Since  <code>' '</code>  has ASCII code 32 and  <code>'r'</code>  has ASCII code 114, “i love leetcode” should be in front of “ironman”. Also we only need to output top 3 hot sentences, so “ironman” will be ignored.</p>
<p><strong>Operation:</strong>  input(’ ')<br>
<strong>Output:</strong>  [“i love you”,“i love leetcode”]<br>
<strong>Explanation:</strong><br>
There are only two sentences that have prefix  <code>"i "</code>.</p>
<p><strong>Operation:</strong>  input(‘a’)<br>
<strong>Output:</strong>  []<br>
<strong>Explanation:</strong><br>
There are no sentences that have prefix  <code>"i a"</code>.</p>
<p><strong>Operation:</strong>  input(’#’)<br>
<strong>Output:</strong>  []<br>
<strong>Explanation:</strong><br>
The user finished the input, the sentence  <code>"i a"</code>  should be saved as a historical sentence in system. And the following input will be counted as a new search.</p>
<p><strong>Note:</strong></p>
<ol>
<li>The input sentence will always start with a letter and end with ‘#’, and only one blank space will exist between two words.</li>
<li>The number of  <strong>complete sentences</strong>  that to be searched won’t exceed 100. The length of each sentence including those in the historical data won’t exceed 100.</li>
<li>Please use double-quote instead of single-quote when you write test cases even for a character input.</li>
<li>Please remember to  <strong>RESET</strong>  your class variables declared in class AutocompleteSystem, as static/class variables are  <strong>persisted across multiple test cases</strong>. Please see  <a href="https://leetcode.com/faq/#different-output">here</a>  for more details.</li>
</ol>
<p><strong>[Solution]</strong></p>
<pre class=" language-java"><code class="prism  language-java"><span class="token keyword">class</span> <span class="token class-name">AutocompleteSystem</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Trie</span> <span class="token punctuation">{</span>
        <span class="token keyword">char</span> c<span class="token punctuation">;</span>
        Trie<span class="token punctuation">[</span><span class="token punctuation">]</span> children<span class="token punctuation">;</span>
        <span class="token keyword">boolean</span> isWord<span class="token punctuation">;</span>
        
        <span class="token keyword">public</span> <span class="token function">Trie</span><span class="token punctuation">(</span><span class="token keyword">char</span> c<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>c <span class="token operator">=</span> c<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>children <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Trie</span><span class="token punctuation">[</span><span class="token number">27</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>isWord <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    Trie root<span class="token punctuation">;</span>
    Trie curTrie<span class="token punctuation">;</span>
    String curStr<span class="token punctuation">;</span>
    Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Integer<span class="token operator">&gt;</span> map<span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token function">AutocompleteSystem</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> sentences<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> times<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        root <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Trie</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> sentences<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">addWord</span><span class="token punctuation">(</span>sentences<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>sentences<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> times<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    
        curStr <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
        curTrie <span class="token operator">=</span> root<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">void</span> <span class="token function">addWord</span><span class="token punctuation">(</span>String word<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Trie node <span class="token operator">=</span> root<span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> word<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">char</span> c <span class="token operator">=</span> word<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">==</span> <span class="token string">' '</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">26</span><span class="token punctuation">]</span> <span class="token operator">==</span> null<span class="token punctuation">)</span> node<span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">26</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Trie</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                node <span class="token operator">=</span> node<span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">26</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>children<span class="token punctuation">[</span>c <span class="token operator">-</span> <span class="token string">'a'</span><span class="token punctuation">]</span> <span class="token operator">==</span> null<span class="token punctuation">)</span> node<span class="token punctuation">.</span>children<span class="token punctuation">[</span>c <span class="token operator">-</span> <span class="token string">'a'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Trie</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
                node <span class="token operator">=</span> node<span class="token punctuation">.</span>children<span class="token punctuation">[</span>c <span class="token operator">-</span> <span class="token string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        
        node<span class="token punctuation">.</span>isWord <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> List<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span> <span class="token function">input</span><span class="token punctuation">(</span><span class="token keyword">char</span> c<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        List<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span> res <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">==</span> <span class="token string">'#'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">addWord</span><span class="token punctuation">(</span>curStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
            map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>curStr<span class="token punctuation">,</span> map<span class="token punctuation">.</span><span class="token function">getOrDefault</span><span class="token punctuation">(</span>curStr<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            curStr <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
            curTrie <span class="token operator">=</span> root<span class="token punctuation">;</span>
            <span class="token keyword">return</span> res<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token keyword">if</span> <span class="token punctuation">(</span>curTrie <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">==</span> <span class="token string">' '</span><span class="token punctuation">)</span> curTrie <span class="token operator">=</span> curTrie<span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">26</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">else</span> curTrie <span class="token operator">=</span> curTrie<span class="token punctuation">.</span>children<span class="token punctuation">[</span>c<span class="token operator">-</span> <span class="token string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        PriorityQueue<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span> pq <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PriorityQueue</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">==</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> b<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">else</span> <span class="token keyword">return</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">-</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">search</span><span class="token punctuation">(</span>curTrie<span class="token punctuation">,</span> curStr<span class="token punctuation">,</span> pq<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>pq<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> res<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> pq<span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        curStr <span class="token operator">=</span> curStr <span class="token operator">+</span> c<span class="token punctuation">;</span>
        
        <span class="token keyword">return</span> res<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">void</span> <span class="token function">search</span><span class="token punctuation">(</span>Trie node<span class="token punctuation">,</span> String cur<span class="token punctuation">,</span> PriorityQueue<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span> pq<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>node <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>isWord<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            pq<span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span>cur<span class="token operator">+</span>node<span class="token punctuation">.</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>pq<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">3</span><span class="token punctuation">)</span> pq<span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">26</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">search</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>children<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> cur <span class="token operator">+</span> node<span class="token punctuation">.</span>c<span class="token punctuation">,</span> pq<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
</div>
</body>

</html>
